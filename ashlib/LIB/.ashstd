#!/usr/local/bin/ash
#
# Assistant Shell (ash) v1.13a (C) Sergey Vovk, 1990-1993
#
# Стандартная настройка интерпретатора ash
# Tue Jun  1 22:41:47 MVT 1993
#
# Содержимое этого файла содержит информацию, которая может быть изменена
# пользователем. Ответственность за любые исправления ложится на их автора.
#
# Формат файлов настройки будет развиваться, подробности в конце файла.
#
# /usr/local/lib/ash/.ashstd - этот файл
# $HOME/.ashstd             - персональная версия этого файла
#
#-------------------------------------------------------
#       Названия клавиш:
-1sh>
-2Menu
-3View
-4Edit
-5Copy
-6MovRen
-7Misc
-8Remove
-9SETUP
-0exit
#-------------------------------------------------------
# Умолчания: как заполнить(fill), откуда(in), куда копировать(out).
#  : - встроенная команда ls (понимает флаги -F, -L -a)
#-f:FL
#-@ номер поля или вырезка для подстановки по '##', см. .ashproc

-f:Fa
-i.
-o.
-@
#-------------------------------------------------------
#
# Реакция на клавишу. Проверяется 2 условия:
# rwx     :полномочия доступа к реперному файлу (здесь к текущему каталогу)
# - или + :наличие помеченных файлов
#-------------------------------------------------------
# Редактирование последней команды sh:
:[1!]
	r?x ?   _sh
# Меню пользователя
:2
:U2
	r?x ?   _menu2 .ashmenu
# Просмотр файла
:3
:U3
	r?x ?   +View
#-------------------------------------------------------
# Действие над файлом(объектом). Проверяются 3 условия:
# полномочия доступа к объекту (файлу),
# тип объекта (см.пояснения в конце этого файла),
# шаблон имени объекта.
# Шаблоны имен задаются так же, как шаблоны имен файлов /bin/sh.
#
# Таблица может быть расположена в любом месте файла настройки,
# см. ниже +View, +ed, ...
#-------------------------------------------------------
+View
	r?? ? *.C       ccat #@
#                            здесь и далее нужен gzip, слинкованный с zcat
	r?? D *.tar.[zpC]    :gzip -d < #@ | tar -tvf -
	r?? D *.tar.gz       :gzip -d < #@ | tar -tvf -
	r?? D *.taz          :gzip -d < #@ | tar -tvf -
	r?? D *.tgz          :gzip -d < #@ | tar -tvf -
	r?? D *.tar.[Z]      :zcat < #@ | tar -tvf -
	r?? D *.zip          zipinfo -m #@
	r?? D *.arj          unarj l #@
	r?? D *.zoo          zoo l #@
	r?? [DT] *.cpio      cpio -itv -I#@
	r?? [DT] *.cpio.[Z]  zcat < #@ | cpio -itv
	r?? [DT] *.cpio.gz   gzip -d < #@ | cpio -itv
	r?? [DT] *.cpio.[zpC] gzip -d < #@ | cpio -itv
	r?? ? *.[zCp]        gzip -d < #@
	r?? ? *.[Z]          zcat < #@
	r?? ? *.gz           gzip -d < #@
	r?? A *.a            ar t #@
	r?? O *.o            :nm -np #@
	r?? O *.si           :nm -np #@
	r?? O *              nm -np #@
	r?? D *.tar          tar -tvf #@
	r?? D *              hd -a #@ | #m
	r?? T .a             :tail -f #@
	r?? T a              :tail -f #@
	r?? T *              :#m #@
	r?? E *              _msg Файл нулевой длины
	r?x d *              :ls -aCF #@
	r?? M *              frm -n #@
	*   ? *              :ls -ld #@ ; file #@
+nl
	r?? ? *.tar.[Z]      zcat < #@ | tar -xvf -
	r?? ? *.tar.[zZCp]   gzip -d < #@ | tar -xvf -
	r?? ? *.tar.gz       gzip -d < #@ | tar -xvf -
	r?? ? *.taz          gzip -d < #@ | tar -xvf -
	r?? ? *.tgz          gzip -d < #@ | tar -xvf -
	r?? D *.zip          unzip -d #@
	r?? D *.arj          unarj x #@
	r?? D *.zoo          zoo x #@
	r?? [DT] *.cpio         cpio -idm -I#@
	r?? [DT] *.cpio.[Z]     zcat < #@ | cpio -idm
	r?? [DT] *.cpio.[zp]    gzip -d < #@ | cpio -idm
	r?? [DT] *.cpio.gz      gzip -d < #@ | cpio -idm
	r?? ? *.[zCp]           gzip -d #@
	r?? ? *.[Z]             uncompress #@
	r?? ? *.gz              gzip -d #@
	r?? [ET] .*.b       rm -f .*.b .,resv.*
	r?? [ET] *.b        rm -f *.b .,resv.*
	r?? A *             ar xv #@
	r?? T [Mm]ake*      make -f #@
	r?? * *.tar         tar -xvf #@
	r?? * *.man         nroff -man #@ | #m
	r?? T *.lav         make #*.lb
	r?? T *.la          make #*.lb
	r?? T *.cv          make #*.c
	r?? T *.xpm         :sxpm #@ &
	r?? T *.c           make #*.o
	r?? T *.pl          make #*.pl
	r?? T .ashhist      _msg #@ Is not ash's program script
	r?? T .ash*         _cmdset #@
#        ??x [TO] *          ./#@
# a.out ОС XENIX в SYSV выглядит как неопознанные данные...
	??x [TOD] *     ./#@
	--x [-] *       ./#@
	r?x d .         _msg Купите на Привозе селедку и крутите ей мозги - мы стоим на Дерибасовской!  :)
	r?x d *         :cd #@
	r?? M *         mailx -f #@
#        r?? D *.bat     vpix z:#@
#        r?? D *.com     vpix z:#@
#        r?? D *.exe     vpix z:#@
	r?? D *.bat     dos #@
	r?? D *.com     dos #@
	r?? D *.exe     dos #@

# Редактирование файла
:4
:U4
	r-x ?   +ed
	rwx ?   +edw
+ed
	rwx d *         :cd #@
# vi не создает нового файла в каталоге
# а red, например, создает...
	rw? [TE] *      vi #@
	rw? M *         elm -f ./#@
	r?? [OD] *      strings #@ | #m
+edw
	rwx d *         :cd #@
	rw? [TE] *      #e #@
	rw? M *         elm -f #@
	r?? [OD] *      strings #@ | #m
# Копирование файлов (требуется еще один аргумент)
# это место в ash так и осталось недоделано...
# как изврат, применяется так:
#  помечаем клавишей пробел, что надо, редактируем строку,
#  нажимаем клавишу Ввод.
# Если нажать Ввод, ничего не исправляя, то cp или mv изругается про
# то, что файлы идентичны.
# Оказалось очень удобно - быстро, и никаких лишних вопросов от ash.
:5
:U5
	rwx -   +CP
	r?x ?   cp ## .
+CP
	* * .   _
	* * ..  _
	* * *   cp #@ #@

# Переименование/перенос файлов (требуется еще один аргумент)
:6
:U6
	rwx -   +MV
	rwx ?   mv ## .
+MV
	* * .   _
	* * ..  _
	* * *   mv #@ #@

:7
:U7
# Еще одно субменю со сменой программы клавиш ash:
# Создание файла/каталога/файлов.системы/формат.диска;

	* *     _cmdset .ashmisc
# Уничтожение файлов/каталогов
:8
:U8
	r-x ?           _err Запись в каталог запрещена
	rwx -           +Rmfile
	rwx ?           rm -f ##
+Rmfile
	r?x d ..        _msg Не руби сук, на котором сидишь...
	r?x d .         _msg Не руби сук, на котором сидишь...
	rwx d *         rm -r -f ./#@
	* * -*          rm -f ./#@
	rw? [AODETM] *    rm -f ./#@
#        rw? T *         rm -f #@
	r-? ? *         rm -f ./#@  # ФАЙЛ ЗАЩИЩЕН ОТ ЗАПИСИ !
# Настройка интерпретатора (флаги, команды)
:9
:U9
	??? ?   _sup
# Конец работы, ВЫХОД
:0
:EX
	* *     exit
# Вызов подсказки
:[?]
:HE
	* * _cmdset .ashhelp

# Полезное действие (выполнить, распаковать, войти в объект, и т.п.),
# см. выше +nl, +View
:NL
	??? ?   +nl
:^F
#       Освежить стандартную настройку ash (при отладке этого файла)
	r?x ?   _cmdset .ashstd
:&
#       Программа (настройка) ash для работы с процессами
	* *     :ASH=l20ps; export ASH; exec ash .ashproc
#        * *     _cmdset .ashproc

#:[2-90]
#        * *     _msg нажимайте функциональные клавиши F1 - F10...
:[./a-z]
#       любая клавиша нижнего регистра - начало ввода команды sh.
	* *     _sh #k



#-------------------------------------------------------
#          Прочие часто используемые команды:
#-------------------------------------------------------
# Синонимы для перехода в другие каталоги
:H
#       Перейти в домашний каталог (HOME)
	* *     :cd
:[U]
:[:]
	* *     :cd ..

:A
# зависит от настройки ash при компиляции.
	* *     :cd /usr/local/lib/ash
# Меню настройки цветастости (петухастости) консоли ISC UNIX
:C
	r?x ?   _menu2 .ashcolor

# Сравнение файлов
:D
	r?x +   +diff
	rwx -   _msg Надо пометить два файла
+diff
	* * * :diff -b ##

:E
	* *     :cd /etc
:[\\]
	* *     :cd /
###:S
###       Состояние процессов
###        * *     :ps -l

#:A
##       Показать программу клавиш ash (Этот файл).
#        * *     #m /usr/local/lib/ash/.ashstd
:M
#       Посмотреть раздел оперативного руководства по компоненте,
#       правильно работает в каталоге с файлами man (/usr/catman,
#       /usr/local/man). Может работать в каталогах /bin, /lib /include)
#       2 строки нужны из-за ошибки в ash, связанной с подстановкой аргумента #*
	* *.*   :man #*
	* *     :man #@
:R
# Повторить команду для помеченных файлов
# (echo как пример команды sh)
	* *     for i in ## ;do echo $i; done

:V
	* *     +Vedit

+Vedit
# быстрый вызов vi, права доступа по записи не проверять
	r?? [TE] * :vi #@
	r?? M * :elm -f #@

:F
	* -   :file #@
	* *   :file ##
:L
	* -   :ls -la | #m
	* *   :ls -ld ##
:X
#       установить полномочия выполнения (для командных файлов)
	* -     chmod +x #@
	* ?     chmod +x ##
:W
# Сменить полномочия записи файла
	* -     +wprot
# для группы помеченных файлов убрать права записи
	* *     chmod a-w ##
+wprot
	?w? ? *         chmod a-w #@
#                       chmod +w лучше, но в SYSV umask не влияет на chmod
	?-? ? *         chmod ug+w #@

:O
# Закрыть файл или помеченную группу файлов для категории 'прочие'
	* -     chmod -orwx #@
	* *     chmod o-rwx ##

:[#]
	* *     _file #@

:[=]
	* *     _rescan
#        * *     :cd .
:^Z
:^B
# Приостановить ash, вернуться в csh
#        * *     :/bin/csh -cf "suspend; exit 0;"
	* *     _sus
#-------------------------------------------------------
#       Простое напоминание (так как работа идет в латинском регистре),
#       но в принципе здесь возможна и другая точка зрения.
# Диапазон зависит от кодовой таблицы, здесь КОИ-8

:[Ю-Чю-ъ]
	??? ?   _msg Включите латинский регистр

#-------------------------------------------------------
#:[#]
#        * *     _kshow

# Посмотреть подстановки ash (для отладки:
#       #e - редактор (из переменной окружения EDITOR, или re)
#       #@ - имя возле курсора (строка главного меню, обычно имя файла).
#       #* - имя без суффикса
#       #s - суффикс имени с точкой
#       #S - суффикс имени без точки
:@
	* *     _sh echo # s='#s' S='#S' *='#*' e='#e'

:*
	* * _msg Undefined key (.ashstd || termcap) - клавиша не определена

#-----------------------------------------
# Структура файла настройки (Формат будет меняться).
#
# (C) Вовк Сергей Владимирович, 1990-1993
#     vsv@st.simbirsk.su <Sergey V.Vovk>
#
#
# Строка начинается с одного из символов:
#       # строка комментария и пустая строка игнорируются;
#       : код нажатой клавиши, начало программы этой клавиши;
#       + действие (имя действия), начало таблицы действия над пунктом меню;
#       пробел, табуляция
#         продолжение таблицы программы клавиши или действия.
# Символ типа файла (в таблицах действий):
#       d       каталог (directory)
#       b       блочный специальный (например /dev/rk0)
#       c       символьный специальный (например /dev/tty1)
#       E       пустой (Empty)
#       O       объектный формата a.out (Object)
#       A       архивный (формат программы ar)
#       T       текстовый  (Text)
#       D       неопознанные данные (Data)
#       M       почтовый ящик, текстовый файл со строкой 'From '
#               в первых 5 байтах, реализовано в ASH V1.9
#       !       вовсе не файл, например строка из выдачи /bin/ps,
#               пока не реализовано.
#-----------------------------------------
# Конец файла настройки .ashstd
#-----------------------------------------
